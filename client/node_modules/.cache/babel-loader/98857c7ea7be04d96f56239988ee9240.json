{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/Lions/FullstackFinalProject/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/Lions/FullstackFinalProject/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/Lions/FullstackFinalProject/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useState,useEffect}from'react';import'./Card.css';import more from'./more.png';import{Link}from'react-router-dom';import{supabase}from'../client';import{formatDistanceToNow}from'date-fns';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Card=function Card(props){var _useState=useState(0),_useState2=_slicedToArray(_useState,2),count=_useState2[0],setCount=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),createdAt=_useState4[0],setCreatedAt=_useState4[1];useEffect(function(){var fetchData=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var _yield$supabase$from$,data,error;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return supabase.from('criteria').select('upvotes, created_at').eq('id',props.id).single();case 2:_yield$supabase$from$=_context.sent;data=_yield$supabase$from$.data;error=_yield$supabase$from$.error;if(data){setCount(data.upvotes);setCreatedAt(formatDistanceToNow(new Date(data.created_at),{addSuffix:true}));}else{console.error('Error fetching data:',error);}case 6:case\"end\":return _context.stop();}}},_callee);}));return function fetchData(){return _ref.apply(this,arguments);};}();fetchData();},[props.id]);var updateCount=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(event){var newCount,_yield$supabase$from$2,error;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:event.preventDefault();newCount=count+1;setCount(newCount);// Optimistically update the frontend\n_context2.next=5;return supabase.from('criteria').update({upvotes:newCount}).eq('id',props.id);case 5:_yield$supabase$from$2=_context2.sent;error=_yield$supabase$from$2.error;if(error){console.error('Failed to update upvotes:',error);setCount(count-1);// Revert the optimistic update on error\nalert('Failed to update upvotes. Please try again!');}case 8:case\"end\":return _context2.stop();}}},_callee2);}));return function updateCount(_x){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"div\",{className:\"Card\",children:[/*#__PURE__*/_jsx(\"h2\",{children:props.title}),/*#__PURE__*/_jsx(\"h3\",{children:\"Subtopic: \"+props.subtopic}),/*#__PURE__*/_jsx(\"p\",{children:props.content}),/*#__PURE__*/_jsx(\"p\",{className:\"created-at\",children:\"Created \"+createdAt}),/*#__PURE__*/_jsxs(\"button\",{className:\"upvoteButton\",onClick:updateCount,children:[\"Upvotes \\u2B06\\uFE0F \",count]}),/*#__PURE__*/_jsx(Link,{to:\"/edit/\".concat(props.id),children:/*#__PURE__*/_jsx(\"button\",{className:\"editButton\",children:\"Edit Post\"})})]});};export default Card;","map":{"version":3,"names":["React","useState","useEffect","more","Link","supabase","formatDistanceToNow","Card","props","count","setCount","createdAt","setCreatedAt","fetchData","from","select","eq","id","single","data","error","upvotes","Date","created_at","addSuffix","console","updateCount","event","preventDefault","newCount","update","alert","title","subtopic","content"],"sources":["C:/Users/Lions/FullstackFinalProject/client/src/components/Card.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport './Card.css';\r\nimport more from './more.png';\r\nimport { Link } from 'react-router-dom';\r\nimport { supabase } from '../client';\r\nimport { formatDistanceToNow } from 'date-fns';\r\n\r\nconst Card = (props) => {\r\n  const [count, setCount] = useState(0);\r\n  const [createdAt, setCreatedAt] = useState('');\r\n\r\n  useEffect(() => {\r\n    const fetchData = async () => {\r\n      const { data, error } = await supabase\r\n        .from('criteria')\r\n        .select('upvotes, created_at')\r\n        .eq('id', props.id)\r\n        .single();\r\n\r\n      if (data) {\r\n        setCount(data.upvotes);\r\n        setCreatedAt(formatDistanceToNow(new Date(data.created_at), { addSuffix: true }));\r\n      } else {\r\n        console.error('Error fetching data:', error);\r\n      }\r\n    };\r\n\r\n    fetchData();\r\n  }, [props.id]);\r\n\r\n  const updateCount = async (event) => {\r\n    event.preventDefault();\r\n\r\n    const newCount = count + 1;\r\n    setCount(newCount);  // Optimistically update the frontend\r\n\r\n    const { error } = await supabase\r\n      .from('criteria')\r\n      .update({ upvotes: newCount })\r\n      .eq('id', props.id);\r\n\r\n    if (error) {\r\n      console.error('Failed to update upvotes:', error);\r\n      setCount(count - 1);  // Revert the optimistic update on error\r\n      alert('Failed to update upvotes. Please try again!');\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"Card\">\r\n      <h2>{props.title}</h2>\r\n      <h3>{\"Subtopic: \" + props.subtopic}</h3>\r\n      <p>{props.content}</p>\r\n      <p className=\"created-at\">{\"Created \" + createdAt}</p>\r\n      <button className=\"upvoteButton\" onClick={updateCount}>\r\n        Upvotes ⬆️ {count}\r\n      </button>\r\n      <Link to={`/edit/${props.id}`}><button className=\"editButton\">Edit Post</button></Link>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Card;\r\n"],"mappings":"mZAAA,MAAOA,MAAP,EAAgBC,QAAhB,CAA0BC,SAA1B,KAA2C,OAA3C,CACA,MAAO,YAAP,CACA,MAAOC,KAAP,KAAiB,YAAjB,CACA,OAASC,IAAT,KAAqB,kBAArB,CACA,OAASC,QAAT,KAAyB,WAAzB,CACA,OAASC,mBAAT,KAAoC,UAApC,C,wFAEA,GAAMC,KAAI,CAAG,QAAPA,KAAO,CAACC,KAAD,CAAW,CACtB,cAA0BP,QAAQ,CAAC,CAAD,CAAlC,wCAAOQ,KAAP,eAAcC,QAAd,eACA,eAAkCT,QAAQ,CAAC,EAAD,CAA1C,yCAAOU,SAAP,eAAkBC,YAAlB,eAEAV,SAAS,CAAC,UAAM,CACd,GAAMW,UAAS,4FAAG,gMACcR,SAAQ,CACnCS,IAD2B,CACtB,UADsB,EAE3BC,MAF2B,CAEpB,qBAFoB,EAG3BC,EAH2B,CAGxB,IAHwB,CAGlBR,KAAK,CAACS,EAHY,EAI3BC,MAJ2B,EADd,4CACRC,IADQ,uBACRA,IADQ,CACFC,KADE,uBACFA,KADE,CAOhB,GAAID,IAAJ,CAAU,CACRT,QAAQ,CAACS,IAAI,CAACE,OAAN,CAAR,CACAT,YAAY,CAACN,mBAAmB,CAAC,GAAIgB,KAAJ,CAASH,IAAI,CAACI,UAAd,CAAD,CAA4B,CAAEC,SAAS,CAAE,IAAb,CAA5B,CAApB,CAAZ,CACD,CAHD,IAGO,CACLC,OAAO,CAACL,KAAR,CAAc,sBAAd,CAAsCA,KAAtC,EACD,CAZe,sDAAH,kBAATP,UAAS,0CAAf,CAeAA,SAAS,GACV,CAjBQ,CAiBN,CAACL,KAAK,CAACS,EAAP,CAjBM,CAAT,CAmBA,GAAMS,YAAW,6FAAG,kBAAOC,KAAP,kKAClBA,KAAK,CAACC,cAAN,GAEMC,QAHY,CAGDpB,KAAK,CAAG,CAHP,CAIlBC,QAAQ,CAACmB,QAAD,CAAR,CAAqB;AAJH,uBAMMxB,SAAQ,CAC7BS,IADqB,CAChB,UADgB,EAErBgB,MAFqB,CAEd,CAAET,OAAO,CAAEQ,QAAX,CAFc,EAGrBb,EAHqB,CAGlB,IAHkB,CAGZR,KAAK,CAACS,EAHM,CANN,8CAMVG,KANU,wBAMVA,KANU,CAWlB,GAAIA,KAAJ,CAAW,CACTK,OAAO,CAACL,KAAR,CAAc,2BAAd,CAA2CA,KAA3C,EACAV,QAAQ,CAACD,KAAK,CAAG,CAAT,CAAR,CAAsB;AACtBsB,KAAK,CAAC,6CAAD,CAAL,CACD,CAfiB,wDAAH,kBAAXL,YAAW,6CAAjB,CAkBA,mBACE,aAAK,SAAS,CAAC,MAAf,wBACE,oBAAKlB,KAAK,CAACwB,KAAX,EADF,cAEE,oBAAK,aAAexB,KAAK,CAACyB,QAA1B,EAFF,cAGE,mBAAIzB,KAAK,CAAC0B,OAAV,EAHF,cAIE,UAAG,SAAS,CAAC,YAAb,UAA2B,WAAavB,SAAxC,EAJF,cAKE,gBAAQ,SAAS,CAAC,cAAlB,CAAiC,OAAO,CAAEe,WAA1C,mCACcjB,KADd,GALF,cAQE,KAAC,IAAD,EAAM,EAAE,iBAAWD,KAAK,CAACS,EAAjB,CAAR,uBAA+B,eAAQ,SAAS,CAAC,YAAlB,uBAA/B,EARF,GADF,CAYD,CArDD,CAuDA,cAAeV,KAAf"},"metadata":{},"sourceType":"module"}